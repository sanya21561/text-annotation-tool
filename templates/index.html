<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Tree</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.10/themes/default/style.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.10/jstree.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        #categoryTree {
            border: 1px solid #ddd;
            padding: 10px;
        }

        #inputSentence {
            padding: 5px;
            width: 400px;
        }

        #textPathPairs {
            margin-top: 10px;
        }

        .textPathPair {
            display: flex;
            margin-bottom: 5px;
        }

        .textInput {
            padding: 5px;
        }

        .pathSelect {
            width: 300px;
        }

        .sentimentSelect {
            width: 100px;
        }

        #addTextPathPair {
            padding: 5px 10px;
            background-color: #0074D9;
            color: white;
            border: none;
            cursor: pointer;
        }

        #addTextPathPair:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="categoryTree"></div>
    <input type="text" id="inputSentence" placeholder="Enter Sentence">
    <div id="textPathPairs">
        <!-- Text-Path-Sentiment Pairs will be added here -->
    </div>
    <button id="addTextPathPair">Add Text</button>
    <button id="updateJson">Save</button>

    <script>
        const categoryTree = [
    {
        "text": "Structure",
        "children": [
            {
                "text": "Topics",
                "children": [
                    "Relevant",
                    "Irrelevant",
                    "Obsolete"
                ]
            },
            {
                "text": "Organization",
                "children": []
            },
            {
                "text": "Order of Topics",
                "children": []
            },
            {
                "text": "Difficulty",
                "children": []
            },
            {
                "text": "Workload",
                "children": []
            }
        ]
    },
    {
        "text": "Evaluation",
        "children": [
            {
                "text": "Grading Criteria",
                "children": [
                    "Assignment",
                    "Quiz",
                    "Midsem/Endsem",
                    "Project",
                    "Presentation",
                    "Labs/Tutorial/Worksheet"
                ]
            },
            {
                "text": "Correctness in Evaluation",
                "children": [
                    "Fairness",
                    "Biasness",
                    "Transparency"
                ]
            },
            {
                "text": "Solutions",
                "children": [
                    "Timings of Upload",
                    "Correctness",
                    "Explanation"
                ]
            },
            {
                "text": "Quality of Questions",
                "children": [
                    "Correctness & Soundness",
                    "Difficulty",
                    "Relevance with Lecture"
                ]
            }
        ]
    },
    {
        "text": "Course Material",
        "children": [
            {
                "text": "Lecture Slides",
                "children": [
                    {
                        "text": "Quality",
                        "children": [
                            "Understandability",
                            "Clarity",
                            "Organization",
                            "Presentation"
                        ]
                    },
                    {
                        "text": "Timings of Upload",
                        "children": []
                    },
                    {
                        "text": "Relevance",
                        "children": [
                            "Coverage of Topics",
                            "Relation with Lecture"
                        ]
                    }
                ]
            },
            {
                "text": "Labs/Tutorial/Assignment Questions",
                "children": [
                    {
                        "text": "Relevance",
                        "children": []
                    },
                    {
                        "text": "Quality",
                        "children": [
                            "Pace",
                            "Difficulty"
                        ]
                    }
                ]
            },
            {
                "text": "Extra Material",
                "children": [
                    "Reference Material",
                    "Practice Sets",
                    "Previous Year Question Papers"
                ]
            }
        ]
    },
    {
        "text": "Lecture Delivery",
        "children": [
            {
                "text": "Teaching Assistants (TAs)",
                "children": [
                    {
                        "text": "Punctuality",
                        "children": []
                    },
                    {
                        "text": "Pedagogical Skills",
                        "children": [
                            "Effectiveness",
                            {
                                "text": "Granularity of Teaching",
                                "children": ["High", "Medium", "Fine"]
                            },
                            "Subject Knowledge",
                            {
                                "text": "Personal Skills",
                                "children": ["Traits", "Voice", "Language"]
                            },
                            {
                                "text": "Interactiveness",
                                "children": ["Approachability", "Peer Engagement"]
                            }
                        ]
                    }
                ]
            },
            {
                "text": "Professor",
                "children": [
                    {
                        "text": "Punctuality",
                        "children": []
                    },
                    {
                        "text": "Pace",
                        "children": []
                    },
                    {
                        "text": "Topics Covered",
                        "children": []
                    },
                    {
                        "text": "Pedagogical Skills",
                        "children": [
                            "Effectiveness",
                            {
                                "text": "Granularity of Teaching",
                                "children": ["High", "Medium", "Fine"]
                            },
                            "Subject Knowledge",
                            {
                                "text": "Personal Skills",
                                "children": ["Traits", "Voice", "Language"]
                            },
                            {
                                "text": "Interactiveness",
                                "children": ["Approachability", "Peer Engagement"]
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "text": "General",
        "children": [
            {
                "text": "Suggestions",
                "children": [
                    {
                        "text": "Course Material",
                        "children": []
                    },
                    {
                        "text": "Evaluation",
                        "children": []
                    },
                    {
                        "text": "Lecture",
                        "children": []
                    },
                    {
                        "text": "Structure",
                        "children": []
                    }
                ]
            },
            "Everything",
            "Nothing"
        ]
    }
];

        function createTextPathSentimentPair() {
            const textPathSentimentPair = document.createElement("div");
            textPathSentimentPair.className = "textPathPair";

            const textInput = document.createElement("input");
            textInput.className = "textInput";
            textInput.placeholder = "Enter Text";

            const pathSelect = document.createElement("select");
            pathSelect.className = "pathSelect";

            // Call the function to populate the dropdown with all levels, including leaf nodes
            populateDropdown(pathSelect, categoryTree);

            const sentimentSelect = document.createElement("select");
            sentimentSelect.className = "sentimentSelect";
            const sentimentOptions = ["positive", "negative", "suggestions"];

            // Populate the sentimentSelect dropdown with sentiment options
            for (const sentiment of sentimentOptions) {
                const option = document.createElement("option");
                option.value = sentiment;
                option.text = sentiment;
                sentimentSelect.appendChild(option);
            }

            textPathSentimentPair.appendChild(textInput);
            textPathSentimentPair.appendChild(pathSelect);
            textPathSentimentPair.appendChild(sentimentSelect);

            document.getElementById("textPathPairs").appendChild(textPathSentimentPair);
        }

        function populateDropdown(select, data, parentPath = []) {
            for (const item of data) {
                const currentPath = [...parentPath, item.text];
                if (item.text) {
                    const option = document.createElement("option");
                    option.value = currentPath.join('/');
                    option.text = currentPath[currentPath.length - 1]; // Display the current node's name
                    select.appendChild(option);
                }
                if (item.children) {
                    populateDropdown(select, item.children, currentPath);
                }
            }
        }

        // Call the createTextPathSentimentPair function to initialize the form
        createTextPathSentimentPair();

        $(function () {
            $('#categoryTree').jstree({
                'core': {
                    'data': categoryTree
                }
            }).on('changed.jstree', function (e, data) {
                // Handle node selection here
                var selectedNode = data.instance.get_node(data.selected[0]);
                console.log('Selected Node: ' + selectedNode.text);
            });

            $('#addTextPathPair').on('click', function () {
                createTextPathSentimentPair();
            });

            $('#updateJson').on('click', function () {
                const sentence = $('#inputSentence').val();
                const textPathSentimentPairs = [];

                // Iterate through textPathSentimentPairs and add them to the array
                $('.textPathPair').each(function () {
                    const text = $(this).find('.textInput').val();
                    const path = $(this).find('.pathSelect').val();
                    const sentiment = $(this).find('.sentimentSelect').val();

                    textPathSentimentPairs.push({
                        text: text,
                        path: path,
                        sentiment: sentiment
                    });
                });

                // Send a request to the server to save the data
                $.ajax({
                    type: 'POST',
                    url: '/save_data',
                    data: JSON.stringify({
                        sentence: sentence,
                        texts: textPathSentimentPairs
                    }),
                    contentType: 'application/json',
                    success: function(response) {
                        alert('Data saved successfully');
                    }
                });
            });
        });
    </script>
</body>
</html>
